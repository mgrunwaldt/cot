<?php

class SiteController extends Controller
{
	public $layout='column1';

	/**
	 * Declares class-based actions.
	 */
	public function actions()
	{
		return array(
			// captcha action renders the CAPTCHA image displayed on the contact page
			'captcha'=>array(
				'class'=>'CCaptchaAction',
				'backColor'=>0xFFFFFF,
			),
			// page action renders "static" pages stored under 'protected/views/site/pages'
			// They can be accessed via: index.php?r=site/page&view=FileName
			'page'=>array(
				'class'=>'CViewAction',
			),
		);
	}

	/**
	 * This is the default 'index' action that is invoked
	 * when an action is not explicitly requested by users.
	 */
	public function actionIndex(){
        
		try{
                    $highlights = Highlights::getAll($this->isMobile);
                    foreach($highlights as $highlight)
                        $highlight->loadHighlightFile();
                    
                    if($this->isMobile)
                        $this->layout = 'mobile';
                    $this->render('index',array('highlights'=>$highlights));
		}
		catch (Exception $ex)
		{
			Errors::log("Error en SiteController/actionIndex",$ex->getMessage(),'');
			$this->redirect('/Site/userError');
		}
		  
	}
        /*
	public function actionTest(){
        
		try{
			$this->renderPartial('test',array());
		}
		catch (Exception $ex)
		{
			Errors::log("Error en SiteController/actionIndex",$ex->getMessage(),'');
			$this->redirect('/Site/userError');
		}
		  
	}
*/
	
	/**
	 * This is the action to handle external exceptions.
	 */
	public function actionError()
	{
            //$this->renderPartial('error', $error);
	    if($error=Yii::app()->errorHandler->error)
	    {
	    	if(Yii::app()->request->isAjaxRequest)
	    		echo $error['message'];
	    	else
	        	$this->renderPartial('error', $error);
	    }
	}
	

	/**
	 * Logs out the current user and redirect to homepage.
	 */
	public function actionLogout()
	{
		try
		{
                    $redirectTo = '/';
                    if(isset(Yii::app()->session['session_admin_id']))
                        $redirectTo = '/Administrators/viewLogin';
                    else if(isset(Yii::app()->session['session_client_user_id']))
                        $redirectTo = '/ClientUsers/viewLogin';

                    session_start();
                    session_destroy();
                    Yii::app()->user->logout();
                    $this->redirect($redirectTo);
                
		}
		catch (Exception $ex)
		{
			Errors::log("Error en UsersController/actionLogout",$ex->getMessage(),'');
			$this->redirect('/Site/userError');
		}
	}
        
        public function actionViewLocation(){
            try{
                if($this->isMobile)
                    $this->layout = 'mobile';
                $this->render('location');
            } catch (Exception $ex) {
                Errors::log("Error en SiteController/actionViewLocation", $ex->getMessage(), '');
                $this->redirect('/Site/userError');
            }
        }
        
        public function actionViewSpirit(){
            try{
                
                if($this->isMobile)
                    $this->layout = 'mobile';
                $this->render('spirit');
            } catch (Exception $ex) {
                Errors::log("Error en SiteController/actionViewSpirit", $ex->getMessage(), '');
                $this->redirect('/Site/userError');
            }
        }
        
        public function actionViewServices(){
            try{
            
                if($this->isMobile)
                    $this->layout = 'mobile';
                $this->render('services');
            } catch (Exception $ex) {
                Errors::log("Error en SiteController/actionViewServices", $ex->getMessage(), '');
                $this->redirect('/Site/userError');
            }
        }
        
        public function actionViewInvestment(){
            try{
                $ranches = Ranches::getAll();
            
                if($this->isMobile)
                    $this->layout = 'mobile';
                $this->render('investments', array('ranches'=>$ranches));
            } catch (Exception $ex) {
                Errors::log("Error en SiteController/actionViewInvestments", $ex->getMessage(), '');
                $this->redirect('/Site/userError');
            }
        }
    
    public function actionAux(){
        /* for($i=4; $i<61; $i++){
            $ranch = new Ranches;
            $ranch->description = 'Chacras de las sierras es una gran oportunidad para concretar una inversión sólida y confiable. Se trata de un emprendimiento único con una demanda creciente para un público que valora lo exclusivo. Desde su origen, el proyecto ha sido pensado tanto para el disfrute así como para asegurar a sus propietarios una excelente inversión.';
            $ranch->lat = '-34.361576287484176';
            $ranch->long = '-55.24466514587402';
            $ranch->name = $i;
            $ranch->ranch_file_id = 12;
            $ranch->created_on = HelperFunctions::getDate();
            $ranch->updated_on = HelperFunctions::getDate();
            $ranch->position = $i;
            $ranch->deleted = 0;
            
            if(!$ranch->save()){
                print_r($ranch->getErrors());
                die();
            }
        } */
    }
    /*
    public function actionAux2(){
        $admnistrators = Administrators::getAll();
        foreach($admnistrators as $admnistrator){
            $admnistrator->password = crypt($admnistrator->password, '$2y$10$prgu832qbD9t4Vs9jyxrhrzB/BxTcg==$');
            $admnistrator->save();
        }
    }*/
}
?>