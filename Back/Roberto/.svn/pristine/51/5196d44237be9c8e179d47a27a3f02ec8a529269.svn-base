
var MMAdminLanguages = {};
MMAdminLanguages.editMode = false;
MMAdminLanguages.languag = {};

MMAdminLanguages.webTexts=new Array();
MMAdminLanguages.languageWebTexts=new Array();
    
$(document).ready(
    function(){

        if($("#webTexts").length>0)
            MMAdminLanguages.webTexts=JSON.parse($("#webTexts").val());
       
        MMAdminLanguages.editMode = $('#selectedLanguagId').length>0;
        if($('#savePositions').length>0){
            $('#adminPositions').sortable();

            $('#savePositions').on({
                'click':function(){
                    MMAdminLanguages.savePositions();
                }
            });
        }
        
        if($('#addLanguag').length>0){
            $('#addLanguag').on({
                'click':function(){
                    if(MMAdminLanguages.editMode)
                        MMAdminLanguages.save();
                    else
                        MMAdminLanguages.add();
                }
            });
        }

        if(MMAdminLanguages.editMode){
            
            var jsonData=$("#languageWebTexts").val();
            MMAdminLanguages.languageWebTexts=JSON.parse(jsonData);
                        
            $('#deleteLanguag').on({
                'click':function(){
                    var id = parseInt($('#selectedLanguagId').val());
                    if(id!==0)
                        if(confirm($('#confirmationText').val()))
                            MMAdminLanguages.remove(id);
                }
            });
            
            MMAdminLanguages.searchThroughTableBinds();
            MMAdminLanguages.checkSelectedLanguag();
        }
});


MMAdminLanguages.getLanguageValues=function($languageId){
  
        var length=MMAdminLanguages.languageWebTexts.length;
        var result=new Array();
        var index=0;
        for(var i=0;i<length;i++){
            var languageWebText=MMAdminLanguages.languageWebTexts[i];
            if(languageWebText.languageId===$languageId){
                result[index]=MMAdminLanguages.languageWebTexts[i];
                index++;
            }
        }
        
        return result;
};

MMAdminLanguages.add = function(){
    MMAdminLanguages.updateLanguagData();
    var loadCode = Tools.showLoading();
    $.ajax({
        type: 'POST',
        url: '/index.php/Languages/add',
        data:{'languag':(MMAdminLanguages.languag)},
        success: function(response){
            response = $.parseJSON(response);
            if(response.status==='ok'){
                Tools.removeLoading(loadCode);
               Tools.alert(response.message,1,function(){Tools.redirect('/index.php/languages/viewEdit/'+response.id);});
            }
            else if(response.status==='error'){
                Tools.alert(response.errorMessage);
                Tools.removeLoading(loadCode);
            }
            else{
                Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
                Tools.removeLoading(loadCode);
            }
        },
        error: function(){
            Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            Tools.removeLoading(loadCode);
        }
    });
};
    
MMAdminLanguages.save = function(){
    MMAdminLanguages.updateLanguagData();
    var loadCode = Tools.showLoading();
    $.ajax({
        type: 'POST',
        url: '/index.php/Languages/save',
        data:{'languag':(MMAdminLanguages.languag)},
        success: function(response){
            response = $.parseJSON(response);
            if(response.status==='ok'){
                Tools.removeLoading(loadCode);
                Tools.alert(response.message,1,function(){Tools.redirect('/index.php/languages/viewEdit/'+MMAdminLanguages.languag.id);});
            }
            else if(response.status==='error'){
                Tools.alert(response.errorMessage);
                Tools.removeLoading(loadCode);
            }
            else{
                Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
                Tools.removeLoading(loadCode);
            }
        },
        error: function(){
            Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            Tools.removeLoading(loadCode);
        }
    });
};

MMAdminLanguages.savePositions = function(){
    var languagIds = new Array();
    $('.adminPosition').each(function() {
        languagIds[languagIds.length] = $(this).attr('id');
    });
    
    var loadCode = Tools.showLoading();
    $.ajax({
        type: 'POST',
        url: '/Languages/savePositions',
        data:{'languagIds':(languagIds)},
        success: function(response){
            response = $.parseJSON(response);
            if(response.status==='ok'){
                Tools.alert(response.message);
            }
            else if(response.status==='error'){
                Tools.alert(response.errorMessage);
            }
            else{
                Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            }
            Tools.removeLoading(loadCode);
        },
        error: function(){
            Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            Tools.removeLoading(loadCode);
        }
    });
};



    
MMAdminLanguages.remove = function(id){
    var loadCode = Tools.showLoading();
    $.ajax({
        type: 'POST',
        url: '/index.php/Languages/delete',
        data:{'id':(id)},
        success: function(response){
            response = $.parseJSON(response);
            if(response.status==='ok'){
                Tools.alert(response.message,1,function(){Tools.refresh();});
            }
            else if(response.status==='error'){
                Tools.alert(response.errorMessage);
                Tools.removeLoading(loadCode);
            }
            else{
                Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
                Tools.removeLoading(loadCode);
            }
        },
        error: function(){
            Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            Tools.removeLoading(loadCode);
        }
    });
};
    
MMAdminLanguages.updateLanguagData = function(){
    var selectedLanguagId = parseInt($('#selectedLanguagId').val());
    if(!isNaN(selectedLanguagId) && selectedLanguagId!==0)
        MMAdminLanguages.languag.id = selectedLanguagId;
    else if($('#languagId').length>0)
        MMAdminLanguages.languag.id = $('#languagId').val();
    else
        MMAdminLanguages.languag.id = 0;
    MMAdminLanguages.languag.name = $('#name').val();
    MMAdminLanguages.languag.is_default = Tools.getValueFromCheckbox($('#is_default'));
    MMAdminLanguages.languag.active = Tools.getValueFromCheckbox($('#active'));
    
    var length=MMAdminLanguages.webTexts.length;
    for(var i=0;i<length;i++){
        var name=MMAdminLanguages.webTexts[i].name.replace(/\ /g,"_");
        var value=$("#"+name).val();
        MMAdminLanguages.webTexts[i].value=value;
    }
    
     MMAdminLanguages.languag.webTexts= MMAdminLanguages.webTexts;
};
    
MMAdminLanguages.checkSelectedLanguag = function(){
    var id = parseInt($('#languagId').val());
    
    if(!isNaN(id) && id!==0){
        MMAdminLanguages.loadLanguagesWebTextsValues($('#languagId').val());
        
        $('#selectedLanguagId').val(id);
        MMAdminLanguages.loadLanguag(id);
    }
};
    
MMAdminLanguages.loadLanguag = function(id){
    var loadCode = Tools.showLoading();
    $.ajax({
        type: 'POST',
        url: '/index.php/Languages/getArray',
        data:{'id':(id)},
        success: function(response){
            response = $.parseJSON(response);
            if(response.status==='ok'){
                MMAdminLanguages.setLanguag(response.languag);
            }
            else{
                Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            }
            Tools.removeLoading(loadCode);
        },
        error: function(){
            Tools.alert('Error obteniendo datos del sitio, verifique su conexión a internet.');
            Tools.removeLoading(loadCode);
        }
    });
};
    
MMAdminLanguages.setLanguag = function(languag){
    MMAdminLanguages.languag = languag;
    $('#id').val(languag.id);
    $('#name').val(languag.name);
    if(parseInt(languag.is_default)===1)
        $('#is_default').attr('class','adminCheckboxChecked');
    else
        $('#is_default').attr('class','adminCheckbox');
    
    if(parseInt(languag.active)===1)
        $('#active').attr('class','adminCheckboxChecked');
    else
        $('#active').attr('class','adminCheckbox');
};
        

            
//------------------------------------------------------------------------------
//---------------------------SearchThroughTables--------------------------------
//------------------------------------------------------------------------------



MMAdminLanguages.searchThroughTableBinds = function(){

   $('#selectedLanguagId').on({
       'change':function(){
            
            var id = $(this).val();
            
            MMAdminLanguages.loadLanguagesWebTextsValues(id);
            
            if(!isNaN(id) && id!==0)
                MMAdminLanguages.loadLanguag(id);
        }
   });
};


MMAdminLanguages.loadLanguagesWebTextsValues=function(id){
    var result=MMAdminLanguages.getLanguageValues(id); 
    
    var length=MMAdminLanguages.webTexts.length;
    for(var i=0;i<length;i++){
            var webText=MMAdminLanguages.webTexts[i];
            if(i<result.length){
                var value=MMAdminLanguages.getValueByWebTextId(result,webText.id);
                $('#'+webText.name.replace(/\ /g,"_")).val(value);//result[i].value);
            }
            
    }
};

MMAdminLanguages.getValueByWebTextId=function(languageWebTexts,webTextId){
    
    for(var i=0;i<languageWebTexts.length;i++){ 
            var auxId=languageWebTexts[i].webTextId;
            if(auxId===webTextId){
                return languageWebTexts[i].value;
            }
    }
    
    return "-null-";
};